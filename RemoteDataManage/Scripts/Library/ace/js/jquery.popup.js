(function(b){function a(c,d){this.input=b(c);this.popupContent=d;this.input.attr("readonly","readonly");this.bindMethodsToObj("show","hide","hideIfClickOutside","selectItem");this.build();this.hide()}a.prototype={build:function(){this.popupController=b('<div class="popupController"></div>').append(this.ClearController);this.popupContent=b('<div class="popupContent"></div>').append(this.popupContent);this.popupPanel=this.rootLayers=b('<div class="popupPanel"></div>').css({display:"none",position:"absolute",zIndex:100000}).append(this.popupContent).appendTo(document.body);if(b.browser.msie&&b.browser.version<7){this.ieframe=b('<iframe class="popupPanel_ieframe" frameborder="0" src="#"></iframe>').css({position:"absolute",display:"none",zIndex:9999}).insertBefore(this.popupPanel);this.rootLayers=this.rootLayers.add(this.ieframe)}},selectItem:function(c,d){this.selectedItem=c;this.input.attr("SelectedItem",c);this.input.val(d)},show:function(){this.setPosition();this.rootLayers.css("display","block");this.input.unbind("focus",this.show);b(document.body).click(this.hideIfClickOutside)},hide:function(){this.rootLayers.css("display","none");b(document.body).unbind("click",this.hideIfClickOutside);this.input.focus(this.show)},hideIfClickOutside:function(c){if(c.target!=this.input[0]&&!this.insideSelector(c)){this.hide()}},setPosition:function(){var c=this.input.offset();this.rootLayers.css({top:c.top+this.input.outerHeight(),left:c.left});if(this.ieframe){this.ieframe.css({width:this.popupPanel.outerWidth(),height:this.popupPanel.outerHeight()})}},insideSelector:function(c){var d=this.popupPanel.offset();d.right=d.left+this.popupPanel.outerWidth();d.bottom=d.top+this.popupPanel.outerHeight();return c.pageY<d.bottom&&c.pageY>d.top&&c.pageX<d.right&&c.pageX>d.left},bindToObj:function(d){var c=this;return function(){return d.apply(c,arguments)}},bindMethodsToObj:function(){for(var c=0;c<arguments.length;c++){this[arguments[c]]=this.bindToObj(this[arguments[c]])}}};b.fn.popup=function(c){return this.each(function(){new a(this,c)})}})(jQuery);